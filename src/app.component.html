
<!-- Flow Control -->
@if (flow() === 'splash') {
    <app-splash></app-splash>
} @else if (flow() === 'onboarding') {
    <app-onboarding></app-onboarding>
} @else if (flow() === 'auth') {
    <app-auth></app-auth>
} @else {
    <!-- Main App Layout -->
    <div class="min-h-screen bg-[#FFFDD0] text-[#1B1B1B] relative">
        
        <!-- Tab Content Rendered Here -->
        @if (activeTab() === 'home') {
            <app-home></app-home>
        } @else if (activeTab() === 'donate') {
            <app-donate></app-donate>
        } @else if (activeTab() === 'education') {
            <app-education></app-education>
        } @else if (activeTab() === 'chat') {
            <app-chat></app-chat>
        } @else if (activeTab() === 'profile') {
            <app-profile></app-profile>
        }

        <!-- Bottom Navigation Bar -->
        <nav class="fixed bottom-0 left-0 w-full bg-white/85 backdrop-blur-lg border-t border-[#D1CDC4] pb-safe pt-2 px-6 flex justify-between items-end h-[85px] z-50">
            
            <button (click)="selectTab('home')" class="flex flex-col items-center gap-1 w-12 pb-4 group">
                <svg [class.text-[#E07A5F]]="activeTab() === 'home'" [class.text-[#3D405B]]="activeTab() !== 'home'" class="w-6 h-6 transition-colors" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span [class.text-[#E07A5F]]="activeTab() === 'home'" [class.text-[#3D405B]]="activeTab() !== 'home'" class="text-[10px] font-bold transition-colors">Beranda</span>
            </button>

            <button (click)="selectTab('education')" class="flex flex-col items-center gap-1 w-12 pb-4 group">
                <svg [class.text-[#E07A5F]]="activeTab() === 'education'" [class.text-[#3D405B]]="activeTab() !== 'education'" class="w-6 h-6 transition-colors" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                <span [class.text-[#E07A5F]]="activeTab() === 'education'" [class.text-[#3D405B]]="activeTab() !== 'education'" class="text-[10px] font-bold transition-colors">Belajar</span>
            </button>

            <!-- Floating FAB for Donate -->
            <div class="relative -top-8">
                <button (click)="selectTab('donate')" class="bg-[#E07A5F] text-white rounded-full p-4 shadow-[0_8px_20px_rgba(224,122,95,0.3)] hover:scale-105 active:scale-95 transition-all border-4 border-[#FFFDD0] flex flex-col items-center justify-center gap-0.5 min-w-[65px]">
                    <svg class="w-7 h-7" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
                    <span class="text-[9px] font-bold uppercase">{{ stateService.currentUser()?.type === 'recipient' ? 'Aksi' : 'Donasi' }}</span>
                </button>
            </div>

            <button (click)="selectTab('chat')" class="flex flex-col items-center gap-1 w-12 pb-4 group">
                <svg [class.text-[#E07A5F]]="activeTab() === 'chat'" [class.text-[#3D405B]]="activeTab() !== 'chat'" class="w-6 h-6 transition-colors" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                <span [class.text-[#E07A5F]]="activeTab() === 'chat'" [class.text-[#3D405B]]="activeTab() !== 'chat'" class="text-[10px] font-bold transition-colors">Diskusi</span>
            </button>

            <button (click)="selectTab('profile')" class="flex flex-col items-center gap-1 w-12 pb-4 group">
                <svg [class.text-[#E07A5F]]="activeTab() === 'profile'" [class.text-[#3D405B]]="activeTab() !== 'profile'" class="w-6 h-6 transition-colors" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                <span [class.text-[#E07A5F]]="activeTab() === 'profile'" [class.text-[#3D405B]]="activeTab() !== 'profile'" class="text-[10px] font-bold transition-colors">Profil</span>
            </button>
        </nav>
    </div>
}
